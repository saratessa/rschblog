---
title: "Examining the Role of Mathematical Language in Preschoolers’ Social and Behavioral Outcomes: A Hierarchical Linear Modeling Approach"
author: "Saratessa Palos"
date: "2025-02-26"
categories: [hlm, code, analysis]
---

## Examining the Role of Mathematical Language in Preschoolers’ Social and Behavioral Outcomes: A Hierarchical Linear Modeling Approach

The present study used a sample of 558 preschool children (Mage = 57.75 months, SD = 3.71). Monthly family income ranged from \$0 to \$5539 (M = \$1508.18, SD = \$892.92). Among the sample, 44% of the children were African American, 32% were Caucasian, 12% were Hispanic, 11% were multiracial, and 1% were Asian.

-   RQ1: Does vocabulary and mathematical language predict social skills in preschoolers?

Hypothesis 1: Higher vocabulary and math language will be associated with better social skills.

-   RQ2: Does vocabulary and mathematical language predict problem behavior in preschoolers?

Hypothesis 2: Lower vocabulary and math language will be associated with higher problem behavior.

```{r}
library(lme4)     
library(haven)      
library(tidyverse)  
library(performance)
library(here)
library(ggplot2)
library(dplyr)    
library(tidyr)    
library(mice)
library(sjPlot)
library(MuMIn) 
```

```{r}
data <- read_dta("/Users/saratessapalos/Desktop/Research/HLM Paper/project/socialskills_problembx/data/data.dta")
```

```{r}
# Select relevant variables 
data_subset <- data %>%
  select(
    id, pkschlid, ppvtst_1, ppvtst_2,   
    mlasm_1, mlasm_2, ssisss_1, ssisss_2, ssispb_1, ssispb_2)       
```

### **Reshaping the Data: Wide to Long Format**

```{r}
data_long <- data_subset %>%
  pivot_longer(
    cols = c(ppvtst_1, ppvtst_2, mlasm_1, mlasm_2, ssisss_1, ssisss_2, ssispb_1, ssispb_2),
    names_to = c(".value", "timepoint"),
    names_sep = "_"
  )

data_long$timepoint <- as.numeric(data_long$timepoint)
```

### **Checking for Missing Values**

```{colSums(is.na(data_long))}
```

### **Handling Missing Data Using Multiple Imputation**

```{r}
# Perform multiple imputation
imputed_data <- mice(data_long, m = 5, method = "pmm", seed = 123)
data_long <- complete(imputed_data, 1)
```

### **Centering Variables for Analysis**

```{r}
data_long <- data_long %>%
  mutate(
    ppvtst_c = scale(ppvtst, center = TRUE, scale = FALSE), 
    mlasm_c = scale(mlasm, center = TRUE, scale = FALSE),  
    ssisss_c = scale(ssisss, center = TRUE, scale = FALSE),  
    ssispb_c = scale(ssispb, center = TRUE, scale = FALSE)  
  )
```

### **Building the Null Models**

```{r}
null_model_social <- lmer(ssisss_c ~ (1 | pkschlid), data = data_long)
null_model_behavior <- lmer(ssispb_c ~ (1 | pkschlid), data = data_long)
```

### **Computing the Intraclass Correlation Coefficient (ICC)**

```{r}
# ICC
icc(null_model_social)
icc(null_model_behavior)
```

### Stepwise Model Building

```{r}
# First, test vocabulary alone
model_social_voc <- lmer(ssisss_c ~ ppvtst_c + (1 | pkschlid), data = data_long)
model_behavior_voc <- lmer(ssispb_c ~ ppvtst_c + (1 | pkschlid), data = data_long)

# Add math language
model_social_full <- lmer(ssisss_c ~ ppvtst_c + mlasm_c + (1 | pkschlid), data = data_long)
model_behavior_full <- lmer(ssispb_c ~ ppvtst_c + mlasm_c + (1 | pkschlid), data = data_long)

# Model comparison
anova(model_social_voc, model_social_full)
anova(model_behavior_voc, model_behavior_full)
```

### Check residual normality

```{r}
qqnorm(resid(model_social_full))
qqline(resid(model_social_full))
qqnorm(resid(model_behavior_full))
qqline(resid(model_behavior_full))
```

### Check homoscedasticity

```{r}
plot(fitted(model_social_full), resid(model_social_full))
plot(fitted(model_behavior_full), resid(model_behavior_full))
```

### Extract fixed and random effects

```{r}
fixef(model_social_full)
fixef(model_behavior_full)
ranef(model_social_full)
ranef(model_behavior_full)
```

### Compute final ICC

```{r}
icc(model_social_full)
icc(model_behavior_full)
```

### Compute effect size

```{r}
r.squaredGLMM(model_social_full)
r.squaredGLMM(model_behavior_full)
```

### Tables

```{r}
sjPlot::tab_model(model_social_full, model_behavior_full, show.std = TRUE, show.ci = TRUE, show.p = TRUE, file = "HLM_Results.doc")
cat("![](HLM_Results.html)")
```
